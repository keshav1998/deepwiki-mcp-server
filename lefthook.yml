# Lefthook configuration for modern Rust development
# Runs formatting, linting, and testing on commit with parallel execution

pre-commit:
  parallel: true
  commands:
    format:
      glob: "**/*.rs"
      run: cargo fmt --check
      stage_fixed: true

    clippy-workspace:
      glob: "**/*.rs"
      run: cargo clippy --workspace --all-targets -- -D warnings

    clippy-wasm:
      glob: "src/**/*.rs"
      run: cargo clippy --target wasm32-wasip1 -- -D warnings

    test-workspace:
      glob: "**/*.rs"
      run: cargo test --workspace

    extension-manifest:
      glob: "extension.toml"
      run: echo "âœ“ Extension manifest updated"

pre-push:
  parallel: true
  commands:
    build-extension:
      glob: "src/**/*.rs"
      run: cargo build --target wasm32-wasip1 --release

    build-bridge:
      glob: "crates/bridge/**/*.rs"
      run: cargo build --manifest-path crates/bridge/Cargo.toml --release

    comprehensive-test:
      run: cargo test --workspace --all-features

# commit-msg validation temporarily disabled
# commit-msg:
#   commands:
#     conventional-commits:
#       run: echo "Commit message validation passed"

# Skip hooks for specific scenarios
skip_output:
  - meta
  - summary
